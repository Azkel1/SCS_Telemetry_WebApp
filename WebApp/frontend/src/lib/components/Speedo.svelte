<!-- ---------------------------------------------------------- JS/TS ---------------------------------------------------------- -->
<script lang="ts">
	import { spring } from 'svelte/motion';

	export let currentSpeed = 0;
	export let currentLimit = 0;
	export let coords: { lat: string; long: string } = { lat: '0', long: '0' };

	let needleRotation = spring(0);
	let limitRotation = spring(0);

	$: needleRotation.set((Math.abs(currentSpeed) * 247.5) / 220);
	$: limitRotation.set((Math.max(currentLimit, 0) * 247.5) / 220);
</script>

<!-- ----------------------------------------------------------- HTML ---------------------------------------------------------- -->
<section id="speedo-container">
	<svg id="speedo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
		<!-- ---------------------------------- BACKGROUND ---------------------------------- -->
		<path
			style="fill:#4d4d4d;stroke-width:.272144"
			d="M141.79341 84.086823a50 50 0 0 1-49.999999 49.999997 50 50 0 0 1-50-49.999997 50 50 0 0 1 50-50 50 50 0 0 1 49.999999 50z"
			transform="translate(-41.793411 -34.086823)"
		/>

		<!-- ---------------------------------- THICK LINES ---------------------------------- -->
		<path
			style="display:inline;fill:#999;stroke-width:.264583"
			d="m4.1717815 39.727227-.1431067.73622-.1431068.736221 10.433725 1.721019.08559-.440309.08559-.440311zM11.826716 21.788917l-.413953.625414-.413952.625414 8.980899 5.582829.247572-.37404.247573-.374042zM25.763648 8.1454953l-.621779.4193947-.621778.4193947 6.160813 8.5947023.371866-.250826.371867-.250827ZM43.860805.87405045l-.734944.14952595-.734943.149526 2.402799 10.2981106.439546-.08943.439547-.08943zM63.363059 1.0815935l-.73622-.14310671-.736221-.14310674L60.169599 11.229105l.440309.08559.440311.08559zM81.301369 8.736528l-.625414-.4139527-.625414-.4139528-5.582829 8.9808995.37404.247572.374042.247573zM94.944791 22.67346l-.419395-.621779-.419395-.621778-8.594702 6.160813.250826.371866.250827.371867zM102.21624 40.770617l-.14953-.734944-.14953-.734943-10.298107 2.402799.08943.439546.08943.439547zM102.00869 60.272871l.14311-.73622.14311-.736221-10.433729-1.721019-.08559.440309-.08559.440311zM94.353758 78.211181l.413953-.625414.413952-.625414-8.980899-5.582829-.247572.37404-.247573.374042zM11.235683 77.326638l.419395.621779.419395.621778 8.594702-6.160813-.250826-.371866-.250827-.371867zM3.9642384 59.229481l.149526.734944.149526.734943 10.2981106-2.402799-.08943-.439546-.08943-.439547z"
			transform="translate(-3.0902365 -.00004938)"
		/>

		<!-- ---------------------------------- THIN LINES ---------------------------------- -->
		<path
			style="fill:gray;stroke-width:.264583"
			d="m9.878338 30.681052 8.314916 3.444151-.153074.369551-8.3149154-3.444151zM20.781861 14.503239l6.363961 6.363961-.282843.282843-6.363961-6.363962zM37.046383 3.729486l3.444151 8.314916-.369552.153073-3.444151-8.3149156zM56.195779-4e-7v9h-.4v-9ZM75.314726 3.88256l-3.444151 8.314916-.369551-.153074 3.444151-8.3149154zM91.492539 14.786083l-6.363961 6.363961-.282843-.282843 6.363962-6.363961zM102.26629 31.050605l-8.314914 3.444151-.153073-.369552 8.314917-3.444151zM105.99578 50.200001h-9.000002v-.4h9.000002zM102.11322 69.318948l-8.314918-3.444151.153074-.369551 8.314914 3.444151zM9.725264 68.949395l8.314916-3.444151.153073.369552-8.3149156 3.444151zM5.9957776 49.799999h9.0000004v.4H5.9957776Z"
			transform="translate(-5.9957776)"
		/>

		<!-- ---------------------------------- SPEED NUMBERS ---------------------------------- -->
		<text class="speed-numbers" x="17.889635" y="73.527847">0</text>
		<text class="speed-numbers" x="12.153464" y="59.098385">20</text>
		<text class="speed-numbers" x="12.248487" y="44.862968">40</text>
		<text class="speed-numbers" x="17.661232" y="32.787537">60</text>
		<text class="speed-numbers" x="26.59145" y="23.347303">80</text>
		<text class="speed-numbers" x="36.755157" y="17.513021">100</text>
		<text class="speed-numbers" x="51.607422" y="17.585268">120</text>
		<text class="speed-numbers" x="64.429398" y="23.538391">140</text>
		<text class="speed-numbers" x="71.323967" y="33.66605">160</text>
		<text class="speed-numbers" x="75.548538" y="45.823009">180</text>
		<text class="speed-numbers" x="74.968102" y="58.742676">200</text>
		<text class="speed-numbers" x="70.287796" y="71.707253">220</text>

		<!-- ---------------------------------- COORD NUMBERS ---------------------------------- -->
		<text class="coord-numbers" x="50" y="79.084908">{coords.lat}W</text>
		<text class="coord-numbers" x="50" y="83.226418">{coords.long}N</text>

		<!-- ---------------------------------- NEEDLE AND SPEED LIMIT ---------------------------------- -->
		<g style="display:inline">
			<path
				id="needle"
				style="fill:#f60;stroke-width:.266248"
				d="m12.752683 74.81676 36.639739-25.285341c.110571-.07631.531813.355015.606914.466409.0751.111393.316975.663644.204773.737529L13.023804 75.218903c-.112202.07388-.261532.04589-.336631-.06551-.0751-.111395-.04506-.260326.06551-.336633z"
				style:transform={`rotate(${$needleRotation}deg)`}
			/>

			<path
				id="speed-limit"
				style="fill:red;stroke-width:.543681"
				d="m8.4111274 77.674254 8.2159936-5.53862c.02094-.01411.0492-.0085.06336.01246l.284239.42164c.01417.02102.0087.0493-.01221.06341l-8.2159935 5.538619c-.020936.01411-.049177.0085-.063357-.01246l-.2846533-.421644c-.014184-.02101-.00831-.0493.012621-.0634z"
				style:transform={`rotate(${$limitRotation}deg)`}
			/>

			<circle style="display:inline;fill:gray;stroke-width:.264583" cx="50" cy="50" r="2.7560763" />
		</g>
	</svg>
</section>

<!-- ----------------------------------------------------------- CSS ----------------------------------------------------------- -->
<style lang="scss">
	#speedo-container {
		#speedo {
			height: 100%;
			width: auto;

			text {
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
				fill: gray;

				&.speed-numbers {
					font-size: 7.05556px;
				}

				&.coord-numbers {
					font-size: 4.23333px;
					text-align: center;
					text-anchor: middle;
				}
			}

			#speed-limit {
				transform-origin: center;
			}

			#needle {
				transform-origin: center;
			}
		}
	}
</style>
